

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Setting Up A Reproducible Environment &#8212; NSAPH Software</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'blog_posts/renv_docker';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Scaling Up/Out Embarrassingly Parallel Problems in R" href="R_embarrassingly_parallel.html" />
    <link rel="prev" title="Python Styling Guide" href="../developers_zone/python.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/NSAPH-Software-Logo_2.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/NSAPH-Software-Logo_2.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    National Studies on Air Pollution and Health Software
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Research Gallery</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../research_gallery/index.html">Research Gallery</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../research_gallery/causalgps_example_1.html">CausalGPS | Example 1</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developers Zone</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../developers_zone/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_zone/contribution.html">Contribution</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../developers_zone/styling_guide.html">Styling Guide</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../developers_zone/r.html">R Styling Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../developers_zone/python.html">Python Styling Guide</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Blog Posts</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Setting Up A Reproducible Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="R_embarrassingly_parallel.html">Scaling Up/Out Embarrassingly Parallel Problems in R</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_R_package.html">Using an R Package in an Ongoing Research</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NSAPH-Software/nsaph-software.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NSAPH-Software/nsaph-software.github.io/edit/main/docs/blog_posts/renv_docker.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NSAPH-Software/nsaph-software.github.io/issues/new?title=Issue%20on%20page%20%2Fblog_posts/renv_docker.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/blog_posts/renv_docker.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Setting Up A Reproducible Environment</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managing-package-dependencies">Managing Package Dependencies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-project-folder">Creating A Project Folder</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initializing-renv">Initializing renv</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-other-porjects-folders">Creating Other Porjects Folders</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-a-package-with-a-different-version">Installing A Package with A Different Version</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-checking-the-environments">Double-checking the Environments</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managing-system-dependencies">Managing System Dependencies</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="setting-up-a-reproducible-environment">
<span id="setting-rep-env"></span><h1>Setting Up A Reproducible Environment<a class="headerlink" href="#setting-up-a-reproducible-environment" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>By: Naeem Khoshnevis</p></li>
<li><p>Last Update: May 22, 2022</p></li>
</ul>
<p>This blog post will review the steps to generate a reproducible environment in developing R packages and conducting research. More specifically, these steps are useful for package maintainers and contributors to set up the development environment seamlessly. Steps to set up runs on an HPC environment will require using Singularity instead of Docker. Feel free to start <a class="reference external" href="https://github.com/orgs/NSAPH-Software/discussions">a new discussion</a> if you need any specific setup for your project.</p>
<p>A robust reproducible environment is possible thanks to the following amazing applications and packges:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.docker.com">Docker</a> and <a class="reference external" href="https://www.rocker-project.org">The Rocker Project</a>,</p></li>
<li><p><a class="reference external" href="https://www.rstudio.com">RStudio</a>, and</p></li>
<li><p><a class="reference external" href="https://rstudio.github.io/renv/articles/renv.html">renv</a></p></li>
</ul>
<figure class="align-default" id="reproducible-env">
<a class="reference internal image-reference" href="../_images/docker_rstudio_renv.png"><img alt="../_images/docker_rstudio_renv.png" src="../_images/docker_rstudio_renv.png" style="height: 80px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Three major components of building a reproducible developing environment.</span><a class="headerlink" href="#reproducible-env" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Have an idea to improve this page? Let’s <a class="reference external" href="https://github.com/orgs/NSAPH-Software/discussions">discuss</a> it.</p>
</div>
<p>In the following, we will work on three packages, with different dependencies.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">#</a></h2>
<p>Reproducibility can be divided into three major parts:</p>
<ul class="simple">
<li><p><strong>System-level</strong>, that includes (read <a class="reference external" href="https://rstudio.github.io/renv/articles/docker.html">more</a>):</p>
<ul>
<li><p>The operating system in use,</p></li>
<li><p>The compiler flags,</p></li>
<li><p>The LAPACK/BLAS system(s) in use, and</p></li>
<li><p>The versions of system libraries.</p></li>
</ul>
</li>
<li><p><strong>Software and Application level</strong>, which mostly includes the versions of the packages in use.</p></li>
<li><p><strong>Code level</strong>, which includes defining initial values of the pseudorandom number generator.</p></li>
</ul>
<p>The containerization platforms (e.g., Docker or Singularity) can be used to address the system-level isolation and reproducibility. Package managers (e.g., renv or conda) can manage different package dependencies and versions. The developers should address code-level reproducibility (also known as setting a seed value) while writing the code. We will not discuss this in this post. Please see this <a class="reference external" href="https://github.com/orgs/NSAPH-Software/discussions/1">discussion</a> for more details.</p>
</section>
<section id="managing-package-dependencies">
<span id="manage-package-dep"></span><h2>Managing Package Dependencies<a class="headerlink" href="#managing-package-dependencies" title="Permalink to this headline">#</a></h2>
<p>To manage the package dependencies, we use the <a class="reference external" href="https://rstudio.github.io/renv/index.html">renv</a> R package. Please read the renv vignettes for more details. In summary:</p>
<ul class="simple">
<li><p>Each folder is a project.</p></li>
<li><p>Each project has one lock.file.</p></li>
<li><p>renv takes care of updating the lock.file.</p></li>
<li><p>renv manages restoring the environment based on the loc.kfile.</p></li>
<li><p>Each project has a library folder inside renv folder.</p></li>
<li><p>Each user has one (or more) global package cache, which is shared across all projects. So you do not need to install one package several times for different projects (Isn’t that amazing!?)</p></li>
</ul>
<p>Let’s go to our running example; we assume we are working with only one R version. <a class="reference internal" href="#renv-projects"><span class="std std-numref">Fig. 2</span></a> represents an overview of the projects, their files, and folders.</p>
<figure class="align-default" id="renv-projects">
<a class="reference internal image-reference" href="../_images/post_1_renv_figure_2.png"><img alt="projects" src="../_images/post_1_renv_figure_2.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">An overview of three projects and a global cache folder for the packages. The renv package will generate the symlinks.</span><a class="headerlink" href="#renv-projects" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>A folder (e.g., <code class="docutils literal notranslate"><span class="pre">Project_A</span></code>) with a <code class="docutils literal notranslate"><span class="pre">DESCRIPTION</span></code> file can be used as a simple example of handling dependencies. To reproduce the example, please follow the steps in the following section.</p>
<section id="creating-a-project-folder">
<span id="create-a-project"></span><h3>Creating A Project Folder<a class="headerlink" href="#creating-a-project-folder" title="Permalink to this headline">#</a></h3>
<ul>
<li><p>Make sure you have RStudio installed on your system (you can install it from <a class="reference external" href="https://www.rstudio.com/products/rstudio/download/">here</a>).</p></li>
<li><p>Open Rstudio and install the <code class="docutils literal notranslate"><span class="pre">devtools</span></code> and the <code class="docutils literal notranslate"><span class="pre">renv</span></code> packages.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;devtools&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;renv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Create the <code class="docutils literal notranslate"><span class="pre">Project_A</span></code> folder.</p></li>
<li><p>Inside the folder, create a <code class="docutils literal notranslate"><span class="pre">DESCRIPTION</span></code> file with the following content.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>Package:<span class="w"> </span>Project_A
Type:<span class="w"> </span>project
Version:<span class="w"> </span><span class="m">0</span>.0.1
Description:<span class="w"> </span>Project_A<span class="w"> </span>Description.
Depends:
<span class="w">  </span>BART<span class="o">(==</span><span class="w"> </span><span class="m">2</span>.2<span class="o">)</span>,
<span class="w">  </span>logger
</pre></div>
</div>
</li>
<li><p>Open the RStudio application, then from the File menu tab, select <code class="docutils literal notranslate"><span class="pre">Open</span> <span class="pre">Project</span></code>, then choose <code class="docutils literal notranslate"><span class="pre">Project_A</span></code> folder’s path.</p></li>
<li><p>This will convert the Project_A folder into an R project (by adding <code class="docutils literal notranslate"><span class="pre">Project_A.Rproj</span></code> file)</p></li>
<li><p>Load the project. By using the following code:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">devtools</span><span class="o">::</span><span class="nf">load_all</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>If you have not already installed <code class="docutils literal notranslate"><span class="pre">BART</span></code> and <code class="docutils literal notranslate"><span class="pre">logger</span></code> packages in your system, this command will raise an error. For example, in the case of <code class="docutils literal notranslate"><span class="pre">BART</span></code>, it will show the following error:</p></li>
</ul>
<div class="highlight-s notranslate"><div class="highlight"><pre><span></span>ℹ<span class="w"> </span><span class="n">Loading</span><span class="w"> </span><span class="n">Project_A</span>
<span class="n">Error</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">`abort_for_missing_packages()`</span><span class="o">:</span>
<span class="o">!</span><span class="w"> </span><span class="n">Dependency</span><span class="w"> </span><span class="nf">package</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;BART&#39;</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available.</span>
</pre></div>
</div>
</li>
<li><p>Install the missing packages. At the time of preparing this post, version <em>2.9</em> of the <code class="docutils literal notranslate"><span class="pre">BART</span></code> package is on CRAN. Install the package using the following code.</p></li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;BART&quot;</span><span class="p">)</span>
<span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;logger&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Now you have all required packages installed on your system.
Please note that we have not used <code class="docutils literal notranslate"><span class="pre">renv</span></code> for package management yet.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each R package can come with different dependencies. For example, in the case of the <strong>Bart</strong> package it will install <strong>nlme</strong>, <strong>nnet</strong>, <strong>survival</strong>, and any other required dependencies. In this post, we are only discussing direct dependencies.</p>
</div>
</section>
<section id="initializing-renv">
<h3>Initializing renv<a class="headerlink" href="#initializing-renv" title="Permalink to this headline">#</a></h3>
<p>We successfully created an R project with two dependencies in the previous section. We have also installed the required packages. Now, we can use <code class="docutils literal notranslate"><span class="pre">renv</span></code> to take a snapshot of the current environment for future restores.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Setting up a customized cache folder gives better control over the projects. We strongly recommend providing a custom path to the global cache folder. This is an important step that needs to be done at the beginning of each session. Please see the following steps for details.</p>
</div>
<ul class="simple">
<li><p>Open the project in RStudio.</p></li>
<li><p>Set a path for your global cache folder.</p></li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">Sys.setenv</span><span class="p">(</span><span class="n">RENV_PATHS_CACHE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;path/to/your/cache/folder&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p>Initiate <code class="docutils literal notranslate"><span class="pre">renv</span></code> in the project.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">renv</span><span class="o">::</span><span class="nf">init</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>This command will create the following files and folders:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">.Rprofile</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">renv.lock</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">renv</span></code> folder.
The command will also add a copy of dependent packages into the global cache folder and generate symlinks for the same packages inside the <code class="docutils literal notranslate"><span class="pre">renv/library</span></code> folder.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>You stored the project dependencies information inside the <code class="docutils literal notranslate"><span class="pre">lock.file</span></code>. Having this <code class="docutils literal notranslate"><span class="pre">lock.file</span></code>, you can always restore this processing/development environment.</p></li>
</ul>
</section>
<section id="creating-other-porjects-folders">
<h3>Creating Other Porjects Folders<a class="headerlink" href="#creating-other-porjects-folders" title="Permalink to this headline">#</a></h3>
<p>Please follow the same steps and create the other projects folder. You can follow all steps mentioned in the <a class="reference internal" href="#create-a-project"><span class="std std-ref">Creating A Project Folder</span></a> section. The only difference is the DESCRIPTION file contents.</p>
</section>
<section id="installing-a-package-with-a-different-version">
<h3>Installing A Package with A Different Version<a class="headerlink" href="#installing-a-package-with-a-different-version" title="Permalink to this headline">#</a></h3>
<p>If you follow the steps in the  <a class="reference internal" href="#create-a-project"><span class="std std-ref">Creating A Project Folder</span></a> section. After running the following code in <code class="docutils literal notranslate"><span class="pre">Project_B</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">devtools</span><span class="p">)</span>
<span class="nf">load_all</span><span class="p">()</span>
</pre></div>
</div>
<p>You will get one error and one warning message.</p>
<div class="highlight-s notranslate"><div class="highlight"><pre><span></span>ℹ<span class="w"> </span><span class="n">Loading</span><span class="w"> </span><span class="n">Project_B</span>
<span class="n">Error</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">`abort_for_missing_packages()`</span><span class="o">:</span>
<span class="o">!</span><span class="w"> </span><span class="n">Dependency</span><span class="w"> </span><span class="nf">package</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;xgboost&#39;</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available.</span>
<span class="n">Run</span><span class="w"> </span><span class="n">`rlang::last_error()`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurred.</span>
<span class="n">Warning</span><span class="w"> </span><span class="n">messages</span><span class="o">:</span>
<span class="m">1</span><span class="o">:</span><span class="w"> </span><span class="n">Need</span><span class="w"> </span><span class="n">BART</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2.5</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">loaded</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="m">2.9</span><span class="w"> </span>
<span class="m">2</span><span class="o">:</span><span class="w"> </span><span class="nf">In </span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="n">dep_name</span><span class="p">,</span><span class="w"> </span><span class="n">dep_ver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;*&quot;</span><span class="p">)</span><span class="w">  </span><span class="o">:</span>
<span class="w">  </span><span class="n">Dependency</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="s">&#39;xgboost&#39;</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">available.</span>
</pre></div>
</div>
<p>We have BART installed in the system. But, the version is different. <code class="docutils literal notranslate"><span class="pre">xgboost</span></code> is not installed; however, at the time of preparing this report, <code class="docutils literal notranslate"><span class="pre">xgboost</span></code> <em>1.6.0.1</em> is on CRAN. We need to install the package from a specific version in such cases.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please note that we <strong>have not</strong> activated renv for this project yet. We have also activated renv for Project_A after installing the BART package. So there is a BART package in our global R library.</p>
</div>
<p>So we can install the missing packages:</p>
<ul>
<li><p>Set up the global cache folder path</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">Sys.setenv</span><span class="p">(</span><span class="n">RENV_PATHS_CACHE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;path/to/your/cache/folder&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Initiate <code class="docutils literal notranslate"><span class="pre">renv</span></code></p>
<ul class="simple">
<li><p>This will install <code class="docutils literal notranslate"><span class="pre">xgboost</span></code> but the one on the CRAN, not the one we need.</p></li>
</ul>
</li>
<li><p>Install packages by version</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">renv</span><span class="o">::</span><span class="nf">install</span><span class="p">(</span><span class="s">&quot;BART@2.5&quot;</span><span class="p">)</span>
<span class="n">renv</span><span class="o">::</span><span class="nf">install</span><span class="p">(</span><span class="s">&quot;xgboost@1.5.0.1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Restart R.</p></li>
<li><p>Run</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">renv</span><span class="o">::</span><span class="nf">status</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>This will tell us that the project is not synchronized.</p></li>
</ul>
</li>
<li><p>Run</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">renv</span><span class="o">::</span><span class="nf">snapshot</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<p>Now, if you take a look at the cache folder, you will see both versions of the <code class="docutils literal notranslate"><span class="pre">BART</span></code> package are available.
Follow the same steps for the <code class="docutils literal notranslate"><span class="pre">Project_C</span></code>.</p>
</section>
<section id="double-checking-the-environments">
<h3>Double-checking the Environments<a class="headerlink" href="#double-checking-the-environments" title="Permalink to this headline">#</a></h3>
<p>We have three projects on the system that we carefully managed the dependencies. Now let’s see if we can seamlessly change the project and get the appropriate dependencies. To test that,</p>
<ul>
<li><p>Open the Project in RStudio</p></li>
<li><p>Run</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">devtools</span><span class="o">::</span><span class="nf">load_all</span><span class="p">()</span>
<span class="nf">sessionInfo</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
<p>Here are the results (only showing related info):</p>
<ul class="simple">
<li><p><strong>Project_A</strong></p>
<ul>
<li><p>logger_0.2.2</p></li>
<li><p>BART_2.9</p></li>
</ul>
</li>
<li><p><strong>Project_B</strong></p>
<ul>
<li><p>xgboost_1.5.0.1</p></li>
<li><p>BART_2.5</p></li>
</ul>
</li>
<li><p><strong>Project_C</strong></p>
<ul>
<li><p>xgboost_1.4.1.1</p></li>
<li><p>BART_2.2</p></li>
</ul>
</li>
</ul>
<p>As you can see, the projects are set up to the correct dependencies without any further action from the user side.</p>
</section>
</section>
<section id="managing-system-dependencies">
<h2>Managing System Dependencies<a class="headerlink" href="#managing-system-dependencies" title="Permalink to this headline">#</a></h2>
<p>In the <a class="reference internal" href="#manage-package-dep"><span class="std std-ref">Managing Package Dependencies</span></a> section, we discussed reproducibility at the package version level. In this section, we want to add one more isolating layer. The steps are discussed in <a class="reference external" href="https://rstudio.github.io/renv/articles/docker.html">Using renv with Docker</a> vignette. In this section, we review those steps by providing more details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To follow these steps, you need to have Docker installed on your system. You can install Docker from <a class="reference external" href="https://docs.docker.com/desktop/">here</a>.</p>
</div>
<p>Understanding different topics and concepts in Docker is beyond the scope of this post. Please read more <a class="reference external" href="https://docs.docker.com/get-started/overview/">here</a>.</p>
<p>Here are steps to have a running container to develop an R package:</p>
<ul>
<li><p><strong>Step 1</strong>: Create a Dockerfile</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A Dockerfile is a recipe to create a docker image. Although for any application we can build it from scratch, in this post, and also most other R related projects, we use images built by great effort by <a class="reference external" href="https://www.rocker-project.org/">The Rocker Project</a>.</p>
</div>
<div class="highlight-s notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span><span class="w"> </span><span class="n">rocker</span><span class="o">/</span><span class="n">verse</span><span class="o">:</span><span class="m">4.1</span><span class="n">.</span><span class="m">0</span>

<span class="n">LABEL</span><span class="w"> </span><span class="n">org.opencontainers.image.authors</span><span class="o">=</span><span class="s">&quot;your_name@email.com&quot;</span>

<span class="c1"># install routine R packages (e.g. installing SuperLearner)</span>
<span class="n">RUN</span><span class="w"> </span><span class="n">install2.r</span><span class="w"> </span><span class="o">--</span><span class="n">error</span><span class="w"> </span><span class="o">--</span><span class="n">skipinstalled</span><span class="w"> </span><span class="o">--</span><span class="n">ncpus</span><span class="w"> </span><span class="m">-1</span><span class="w"> </span>\
<span class="w">    </span><span class="n">SuperLearner</span>

<span class="c1"># install specific version of renv (here 0.15.1)</span>
<span class="n">ENV</span><span class="w"> </span><span class="n">RENV_VERSION</span><span class="w"> </span><span class="m">0.15</span><span class="n">.</span><span class="m">1</span>
<span class="n">RUN</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="s">&quot;install.packages(&#39;remotes&#39;, repos = c(CRAN = &#39;https://cloud.r-project.org&#39;))&quot;</span>
<span class="n">RUN</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="s">&quot;remotes::install_github(&#39;rstudio/renv@${RENV_VERSION}&#39;)&quot;</span>

<span class="c1"># Install Linux internal commands</span>
<span class="n">RUN</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="n">get</span><span class="w"> </span><span class="n">update</span><span class="w"> </span>\
<span class="w">	</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="n">get</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">y</span><span class="w"> </span><span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="n">recommends</span><span class="w"> </span>\
<span class="w">		</span><span class="n">vim</span><span class="w"> </span>\
<span class="w">		</span><span class="n">zsh</span><span class="w"> </span>\
<span class="w">		</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="n">get</span><span class="w"> </span><span class="n">clean</span>
</pre></div>
</div>
</li>
<li><p><strong>Step 2</strong>: Build the Image</p></li>
</ul>
<p>In the terminal (and inside the same folder of the Dockerfile), Run:</p>
<div class="highlight-s notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="n">rvers</span><span class="w"> </span><span class="n">.</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Step 3</strong>: Run the image and create a container</p></li>
</ul>
<p>In order to store the modified values, you need to map the volumes. There are two places to map:</p>
<ul class="simple">
<li><p>The project folder</p></li>
<li><p>The global cache folder</p></li>
</ul>
<p>Run the following code:</p>
<div class="highlight-s notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">it</span><span class="w"> </span><span class="o">--</span><span class="n">rm</span><span class="w"> </span>\
<span class="w">        </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="m">8787</span><span class="o">:</span><span class="m">8787</span><span class="w"> </span>\
<span class="w">        </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">USER</span><span class="o">=</span><span class="n">user</span><span class="w"> </span>\
<span class="w">        </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">PASSWORD</span><span class="o">=</span><span class="n">password</span><span class="w"> </span>\
<span class="w">        </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="s">&quot;[Path to Project A on your system]:/home/user/Project_A&quot;</span><span class="w"> </span>\
<span class="w">        </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="s">&quot;[Path to cache on your system]:/home/user/cache&quot;</span><span class="w"> </span><span class="n">rvers</span>
</pre></div>
</div>
<ul>
<li><p><strong>Step 4</strong>: Open your browser and type <code class="docutils literal notranslate"><span class="pre">http://localhost:8787/</span></code></p>
<ul class="simple">
<li><p>This will pop up RStudio asking for username (<code class="docutils literal notranslate"><span class="pre">user</span></code>) and password (<code class="docutils literal notranslate"><span class="pre">password</span></code>)</p></li>
<li><p>Input the provided values.</p></li>
</ul>
</li>
<li><p><strong>Step 5</strong>: Set up global cache path</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">Sys.setenv</span><span class="p">(</span><span class="n">RENV_PATHS_CACHE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/home/user/cache&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Step 6</strong>: Done!</p></li>
</ul>
<p>Now, you have an isolated environment on a new OS (<code class="docutils literal notranslate"><span class="pre">Ubuntu</span> <span class="pre">20.04.4</span> <span class="pre">LTS</span></code>). Inside the RStudio Console, you can run <code class="docutils literal notranslate"><span class="pre">sessionInfo()</span></code> to see more details about the platform and the used BLAS and LAPACK libraries. The changes will be reflected on your localhost if you add new code. Also, the cache will be connected to your global cache (but under a different folder because of different OS), and next time, they will be loaded if needed.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./blog_posts"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../developers_zone/python.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Python Styling Guide</p>
      </div>
    </a>
    <a class="right-next"
       href="R_embarrassingly_parallel.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Scaling Up/Out Embarrassingly Parallel Problems in R</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managing-package-dependencies">Managing Package Dependencies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-project-folder">Creating A Project Folder</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initializing-renv">Initializing renv</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-other-porjects-folders">Creating Other Porjects Folders</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-a-package-with-a-different-version">Installing A Package with A Different Version</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-checking-the-environments">Double-checking the Environments</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managing-system-dependencies">Managing System Dependencies</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By NSAPH Software Developing Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>